---
import { getCollection } from "astro:content";
import TagPosts from "@layouts/TagPosts.astro";
import getUniqueTags from "@utils/getUniqueTags";
import getPostsByTag from "@utils/getPostsByTag";
import type { GetStaticPathsOptions } from "astro";
import { SITE } from "@config";

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const posts = await getCollection("blog");
  const tags = getUniqueTags(posts);
  const paths = [];

  for (const { tag, tagName } of tags) {
    const tagPosts = await getPostsByTag(posts, tag);
    const paginatedPosts = paginate(tagPosts, {
      params: { tag },
      props: { tagName },
      pageSize: SITE.postPerPage,
    });
    paths.push(...paginatedPosts);
  }

  return paths;
}

const { tag } = Astro.params;
const { page, tagName } = Astro.props;

export const prerender = true;
---

<TagPosts {page} {tag} {tagName} />
